---
import HeaderPage from "../../components/HeaderPage.astro";
import LinkCompositeur from "../../components/LinkCompositeur.astro";
import Layout from "../../layouts/Layout.astro";
import PocketBase from "pocketbase"; // Importation de PocketBase

export const prerender = false;

// Connexion à PocketBase via Pockethost
const pb = new PocketBase("https://sae303.pockethost.io"); // Utilisation de l'URL de ton instance Pockethost

// Récupération des oeuvres depuis PocketBase
const oeuvres = await pb.collection("oeuvres").getFullList({
  expand: "compositeur",
});

const baseUrl = "https://sae303.pockethost.io"; // URL de base de PocketBase
---

<head>
  <link rel="stylesheet" href="/src/styles/global.css" />
</head>

<HeaderPage />
<Layout pageTitle="Liste des oeuvres">
  <section
    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-6"
  >
    {
      oeuvres.map((oeuvre) => (
        <div
          key={oeuvre.id}
          class="bg-gray-800 text-white rounded-lg shadow-lg overflow-hidden"
        >
          <div class="p-4">
            <h2 class="text-xl font-bold mb-2">{oeuvre.titre}</h2>
          </div>
          {oeuvre.expand?.compositeur && (
            <p class="text-lg">
              Composé par :
              <LinkCompositeur
                compositeur={{
                  id: oeuvre.expand.compositeur.id,
                  nom: oeuvre.expand.compositeur.nom,
                }}
              />
            </p>
          )}
          {oeuvre.cover && (
            <img
              src={`${baseUrl}/api/files/oeuvres/${oeuvre.id}/${oeuvre.cover}`}
              alt={`Photo de ${oeuvre.titre}`}
              class="w-32 h-32 mx-auto mb-4 object-cover"
            />
          )}
          {/* Lien vers la page de détails de l'œuvre */}
          <a
            href={`/oeuvres/${oeuvre.id}`}
            class="mt-4 inline-block bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors"
          >
            Voir les détails
          </a>
        </div>
      ))
    }
  </section>
</Layout>
