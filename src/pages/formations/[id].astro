---
import HeaderPage from "../../components/HeaderPage.astro";
import Layout from "../../layouts/Layout.astro";
import PocketBase from "pocketbase"; // Importation de PocketBase
import "../../styles/global.css"; // Import propre du CSS
import LinkOeuvre from "../../components/LinkOeuvre.astro";

export const prerender = false;

// Connexion √† PocketBase via Pockethost
const pb = new PocketBase("https://sae303.pockethost.io"); // Utilisation de l'URL de ton instance Pockethost

// R√©cup√©ration de l'ID du compositeur depuis les param√®tres
const { id } = Astro.params;

if (!id) {
  console.error("‚ùå ID manquant pour la page compositeur.");
  throw new Error("ID manquant pour la page compositeur.");
}

let formation = null;

try {
  console.log(
    "üì° Tentative de r√©cup√©ration du compositeur et de ses ≈ìuvres depuis PocketBase..."
  );

  // R√©cup√©ration du compositeur avec ses ≈ìuvres
  formation = await pb.collection("formations").getOne(id, {
    expand: "oeuvres",
  });

  console.log("‚úÖ Compositeur r√©cup√©r√© avec succ√®s :", formation);
} catch (error) {
  console.error("‚ùå Erreur lors de la r√©cup√©ration du compositeur :", error);
}

const baseUrl = "https://sae303.pockethost.io"; // URL de base de PocketBase
---

<head>
  <link rel="stylesheet" href="/src/styles/global.css" />
</head>

<HeaderPage />

<Layout
  pageTitle={formation
    ? `D√©tails de ${formation.nom_groupe}`
    : "Compositeur introuvable"}
>
  <section
    class="flex flex-col items-center min-h-screen bg-gradient-to-b from-gray-900 to-gray-700 text-white py-12"
  >
    {
      formation ? (
        <>
          <h1 class="text-4xl font-bold mb-6 tracking-wide">
            {formation.nom_groupe}
          </h1>
          
        </>
      ) : (
        <p class="text-red-500 text-center">Formation introuvable.</p>
      )
    }
  </section>
</Layout>
