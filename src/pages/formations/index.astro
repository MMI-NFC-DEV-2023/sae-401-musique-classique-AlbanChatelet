---
import HeaderPage from "../../components/HeaderPage.astro";
import LinkInterpretation from "../../components/LinkInterpretation.astro";
import LinkOeuvre from "../../components/LinkOeuvre.astro";
import Layout from "../../layouts/Layout.astro";
import PocketBase from "pocketbase"; // Importation de PocketBase

export const prerender = false;

// Connexion à PocketBase via Pockethost
const pb = new PocketBase("https://sae303.pockethost.io"); // Utilisation de l'URL de ton instance Pockethost

// Récupération des compositeurs avec leurs œuvres
const formations = await pb.collection("formations").getFullList({
  expand: "interpretations",
});

const baseUrl = "https://sae303.pockethost.io"; // URL de base de PocketBase
---

<head>
  <link rel="stylesheet" href="/src/styles/global.css" />
</head>

<HeaderPage />
<Layout pageTitle="Liste des formations">
  <section
    class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-6"
  >
    {
      formations.map((formation) => (
        <div
          key={formation.id}
          class="bg-gray-800 text-white rounded-lg shadow-lg overflow-hidden"
        >
          <div class="p-4">
            <h2 class="text-xl font-bold mb-2">{formation.nom_groupe}</h2>
          </div>

          {/* Affichage des œuvres associées */}
          {formation.expand?.interpretations &&
            formation.expand.interpretations.length > 0 && (
              <div class="p-4">
                <p class="text-gray-400 mb-2">Œuvres :</p>
                <ul class="list-disc pl-5 space-y-1">
                  {formation.expand.interpretation.map((interpretation) => (
                    <li key={interpretation.id}>
                      <LinkInterpretation
                        interpretation={{
                          id: interpretation.id,
                          titre: interpretation.nom_interpretation,
                        }}
                      />
                    </li>
                  ))}
                </ul>
              </div>
            )}

          {/* Lien vers la page de détails du compositeur */}
          <a
            href={`/formations/${formation.id}`}
            class="mt-4 inline-block bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors"
          >
            Voir les détails
          </a>
        </div>
      ))
    }
  </section>
</Layout>
